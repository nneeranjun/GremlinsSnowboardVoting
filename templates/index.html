
<!DOCTYPE html>
<html>
<head>
<title>Gremlinz Snowboard Trip Voting</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<style>
.trail-map {
  width: 150px;
  height: 120px;
  border-radius: 8px;
  cursor: pointer;
  object-fit: cover;
  border: 2px solid #dee2e6;
  transition: border-color 0.2s;
}
.trail-map:hover {
  border-color: #007bff;
}
.desc {font-family: inherit;}
.desc h5 {color: #0d6efd; font-weight: 600; margin-bottom: 8px;}
.desc ul {padding-left: 20px; margin-bottom: 15px;}
.desc li {margin-bottom: 4px; line-height: 1.4;}
.form-check-input:checked {
  background-color: #007bff;
  border-color: #007bff;
}
#modalImg {width:100%;}
.selection-counter {
  position: fixed;
  top: 20px;
  right: 20px;
  background: #007bff;
  color: white;
  padding: 10px 15px;
  border-radius: 25px;
  font-weight: bold;
  z-index: 1000;
}
.card.selected {
  border: 3px solid #007bff;
  background-color: #e7f3ff;
}
.difficulty-stars {
  font-size: 1.1em;
  letter-spacing: 1px;
}
.table th {
  white-space: nowrap;
  font-size: 0.8em;
  padding: 0.5rem 0.3rem;
}
.table td {
  font-size: 0.75em;
  vertical-align: middle;
  padding: 0.5rem 0.3rem;
  text-align: center;
}
.table td:first-child {
  text-align: left;
}
.table td:last-child {
  text-align: left;
}
.table th:hover {
  background-color: #495057;
}
#destinationTable tbody tr:hover {
  background-color: #f8f9fa;
}
</style>
</head>
<body class="bg-light">
<div class="container py-5">
<h1>üèîÔ∏è Gremlinz Snowboard Trip Voting</h1>
<p class="text-muted">Select exactly 4 destinations. One vote per email. Click trail maps to enlarge.</p>

<div class="alert alert-info" role="alert">
  <strong>Already voted and want to change your vote?</strong> 
  <a href="/manage" class="alert-link">Click here</a> to manage your existing vote.
</div>

<div class="selection-counter" id="counter">Selected: 0/4</div>

<form action="/submit" method="POST">
<label>Email</label>
<input type="email" name="email" class="form-control mb-3" required>

<!-- Collapsible Overview Table -->
<div class="card mb-4">
  <div class="card-header">
    <button class="btn btn-link text-decoration-none p-0 fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#overviewTable" aria-expanded="true">
      üìä Destination Overview Table (Click to collapse)
    </button>
  </div>
  <div class="collapse show" id="overviewTable">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover" id="destinationTable">
          <thead class="table-dark">
            <tr>
              <th onclick="sortTable(0)" style="cursor: pointer;">Name</th>
              <th onclick="sortTable(1)" style="cursor: pointer;">Region</th>
              <th onclick="sortTable(2)" style="cursor: pointer;">Max Elevation (ft)</th>
              <th onclick="sortTable(3)" style="cursor: pointer;">Vertical Drop (ft)</th>
              <th onclick="sortTable(4)" style="cursor: pointer;">Total Runs</th>
              <th onclick="sortTable(5)" style="cursor: pointer;">Green Runs</th>
              <th onclick="sortTable(6)" style="cursor: pointer;">Blue Runs</th>
              <th onclick="sortTable(7)" style="cursor: pointer;">Black Runs</th>
              <th onclick="sortTable(8)" style="cursor: pointer;">Terrain Parks</th>
              <th onclick="sortTable(9)" style="cursor: pointer;">Skiable Acres</th>
              <th onclick="sortTable(10)" style="cursor: pointer;">Annual Snowfall (in)</th>
              <th onclick="sortTable(11)" style="cursor: pointer;">Avg Difficulty</th>
              <th>Flight Cost</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Utah</strong></td>
              <td>US</td>
              <td>11,000</td>
              <td>3,240</td>
              <td>169</td>
              <td>27%</td>
              <td>38%</td>
              <td>35%</td>
              <td>8</td>
              <td>4,700</td>
              <td>500</td>
              <td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</td>
              <td>$250‚Äì$400</td>
            </tr>
            <tr>
              <td><strong>California</strong></td>
              <td>US</td>
              <td>11,053</td>
              <td>3,500</td>
              <td>215</td>
              <td>25%</td>
              <td>40%</td>
              <td>35%</td>
              <td>12</td>
              <td>6,200</td>
              <td>400</td>
              <td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</td>
              <td>$300‚Äì$500</td>
            </tr>
            <tr>
              <td><strong>Montana</strong></td>
              <td>US</td>
              <td>11,166</td>
              <td>4,350</td>
              <td>300</td>
              <td>15%</td>
              <td>25%</td>
              <td>60%</td>
              <td>6</td>
              <td>5,800</td>
              <td>400</td>
              <td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</td>
              <td>$300‚Äì$450</td>
            </tr>
            <tr>
              <td><strong>New Mexico</strong></td>
              <td>US</td>
              <td>12,481</td>
              <td>2,612</td>
              <td>110</td>
              <td>24%</td>
              <td>25%</td>
              <td>51%</td>
              <td>4</td>
              <td>1,294</td>
              <td>305</td>
              <td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</td>
              <td>$250‚Äì$400</td>
            </tr>
            <tr>
              <td><strong>Washington</strong></td>
              <td>US</td>
              <td>7,012</td>
              <td>3,100</td>
              <td>57</td>
              <td>13%</td>
              <td>57%</td>
              <td>30%</td>
              <td>3</td>
              <td>2,600</td>
              <td>368</td>
              <td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</td>
              <td>$250‚Äì$400</td>
            </tr>
            <tr>
              <td><strong>France</strong></td>
              <td>Europe</td>
              <td>12,605</td>
              <td>9,209</td>
              <td>115</td>
              <td>20%</td>
              <td>30%</td>
              <td>50%</td>
              <td>5</td>
              <td>6,800</td>
              <td>310</td>
              <td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</td>
              <td>$500‚Äì$900</td>
            </tr>
            <tr>
              <td><strong>Switzerland</strong></td>
              <td>Europe</td>
              <td>12,739</td>
              <td>7,220</td>
              <td>200</td>
              <td>28%</td>
              <td>40%</td>
              <td>32%</td>
              <td>7</td>
              <td>8,300</td>
              <td>250</td>
              <td>‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ</td>
              <td>$600‚Äì$1,000</td>
            </tr>
            <tr>
              <td><strong>Austria</strong></td>
              <td>Europe</td>
              <td>9,222</td>
              <td>4,921</td>
              <td>340</td>
              <td>30%</td>
              <td>40%</td>
              <td>30%</td>
              <td>9</td>
              <td>7,500</td>
              <td>350</td>
              <td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</td>
              <td>$500‚Äì$900</td>
            </tr>
          </tbody>
        </table>
      </div>
      <small class="text-muted">Click column headers to sort. Costs are estimates and may vary by season.</small>
    </div>
  </div>
</div>

{% for d in destinations %}
<div class="card mb-4" id="card-{{d}}"><div class="card-body">
<div class="d-flex align-items-center mb-3">
  <input type="checkbox" name="destination" value="{{d}}" onchange="updateSelection()" class="form-check-input me-3" style="transform: scale(1.2);">
  <h3 class="mb-0">{{d}}</h3>
</div>

<div class="desc">
  {% for resort, features in descriptions[d].items() %}
    <div class="mb-3">
      <div class="d-flex align-items-start mb-2">
        <div class="flex-grow-1">
          <div class="d-flex align-items-center mb-2">
            <h5 class="text-primary mb-0 me-3">{{resort}}</h5>
            <div class="d-flex align-items-center">
              <small class="text-muted me-2">Terrain Difficulty:</small>
              <span class="difficulty-stars">
                {% for i in range(1, 6) %}
                  {% if i <= difficulty[d][resort] %}
                    <span class="text-warning">‚òÖ</span>
                  {% else %}
                    <span class="text-muted">‚òÜ</span>
                  {% endif %}
                {% endfor %}
              </span>
            </div>
          </div>
          <ul class="mb-0 ms-4">
            {% for feature in features %}
              <li>{{feature}}</li>
            {% endfor %}
          </ul>
        </div>
        <div class="ms-3">
          <img src="{{maps[d][resort]}}" class="trail-map" onclick="openModal('{{maps[d][resort]}}')" alt="{{resort}} Trail Map">
        </div>
      </div>
    </div>
  {% endfor %}
</div>


</div></div>
{% endfor %}

<button class="btn btn-primary btn-lg" id="submitBtn" disabled>Submit Vote</button>
</form>



</div>

<div class="modal fade" id="imgModal" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content bg-dark">
      <img id="modalImg" class="img-fluid">
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
function openModal(src){
 document.getElementById('modalImg').src=src;
 new bootstrap.Modal(document.getElementById('imgModal')).show();
}

function updateSelection() {
  const checkboxes = document.querySelectorAll('input[name="destination"]:checked');
  const count = checkboxes.length;
  const counter = document.getElementById('counter');
  const submitBtn = document.getElementById('submitBtn');
  
  counter.textContent = `Selected: ${count}/4`;
  
  // Update card styling
  document.querySelectorAll('.card').forEach(card => {
    card.classList.remove('selected');
  });
  
  checkboxes.forEach(checkbox => {
    document.getElementById(`card-${checkbox.value}`).classList.add('selected');
  });
  
  // Enable/disable submit button and prevent selecting more than 4
  if (count === 4) {
    submitBtn.disabled = false;
    counter.style.backgroundColor = '#28a745';
    // Disable unchecked checkboxes
    document.querySelectorAll('input[name="destination"]:not(:checked)').forEach(cb => {
      cb.disabled = true;
    });
  } else {
    submitBtn.disabled = true;
    counter.style.backgroundColor = '#007bff';
    // Re-enable all checkboxes
    document.querySelectorAll('input[name="destination"]').forEach(cb => {
      cb.disabled = false;
    });
  }
}

function sortTable(columnIndex) {
  const table = document.getElementById('destinationTable');
  const tbody = table.querySelector('tbody');
  const rows = Array.from(tbody.querySelectorAll('tr'));
  
  // Determine sort direction
  const currentDirection = table.getAttribute('data-sort-direction') || 'asc';
  const newDirection = currentDirection === 'asc' ? 'desc' : 'asc';
  table.setAttribute('data-sort-direction', newDirection);
  
  // Sort rows
  rows.sort((a, b) => {
    let aValue = a.cells[columnIndex].textContent.trim();
    let bValue = b.cells[columnIndex].textContent.trim();
    
    // Handle special cases for sorting
    if (columnIndex >= 2 && columnIndex <= 10) { // Numeric columns (elevation, runs, etc.)
      if (columnIndex === 5 || columnIndex === 6 || columnIndex === 7) { // Percentage columns
        aValue = parseInt(aValue.replace('%', ''));
        bValue = parseInt(bValue.replace('%', ''));
      } else {
        aValue = parseInt(aValue.replace(/[^0-9]/g, ''));
        bValue = parseInt(bValue.replace(/[^0-9]/g, ''));
      }
    } else if (columnIndex === 11) { // Star difficulty column
      aValue = (aValue.match(/‚òÖ/g) || []).length;
      bValue = (bValue.match(/‚òÖ/g) || []).length;
    } else if (columnIndex === 12) { // Cost column
      aValue = parseInt(aValue.replace(/[^0-9]/g, ''));
      bValue = parseInt(bValue.replace(/[^0-9]/g, ''));
    }
    
    if (typeof aValue === 'number' && typeof bValue === 'number') {
      return newDirection === 'asc' ? aValue - bValue : bValue - aValue;
    } else {
      return newDirection === 'asc' ? 
        aValue.localeCompare(bValue) : 
        bValue.localeCompare(aValue);
    }
  });
  
  // Re-append sorted rows
  rows.forEach(row => tbody.appendChild(row));
  
  // Update header indicators
  table.querySelectorAll('th').forEach((th, index) => {
    const text = th.textContent.replace(' üîº', '').replace(' üîΩ', '');
    if (index === columnIndex) {
      th.textContent = text + (newDirection === 'asc' ? ' üîº' : ' üîΩ');
    } else {
      th.textContent = text;
    }
  });
}
</script>
</body>
</html>
