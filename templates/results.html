
<!DOCTYPE html>
<html>
<head>
<title>Results</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
<div class="container py-5">
<h1>üìä Gremlinz Snowboard Trip Voting Results</h1>

{% if winners %}
<div class="alert alert-success mb-4">
  <h4 class="alert-heading">üèÜ Top 4 Destinations Selected!</h4>
  <p class="mb-2"><strong>The winning destinations are:</strong></p>
  <ol class="mb-0">
    {% for winner in winners %}
    <li><strong>{{ winner }}</strong></li>
    {% endfor %}
  </ol>
</div>
{% endif %}

{% if tie_info %}
<div class="alert alert-warning mb-4">
  <h5 class="alert-heading">‚öñÔ∏è Tie-Breaking Applied</h5>
  <p class="mb-2">There was a tie for 4th place with {{ tie_info.fourth_place_votes }} votes each:</p>
  <ul class="mb-2">
    {% for dest in tie_info.tied_destinations %}
    <li>{{ dest }} ({{ tie_info.fourth_place_votes }} votes)</li>
    {% endfor %}
  </ul>
  <p class="mb-0"><small><strong>Tie-breaker:</strong> Alphabetical order was used. 
  {% if tie_info.tied_outside %}
  {{ tie_info.tied_outside|join(', ') }} narrowly missed the top 4.
  {% endif %}
  </small></p>
</div>
{% endif %}

<canvas id="chart"></canvas>

<script>
const chartData = {
  labels: {{labels|tojson}}, 
  datasets:[{
    label:'Votes', 
    data: {{counts|tojson}}, 
    backgroundColor: function(context) {
      const winners = {{winners|tojson}};
      const label = context.chart.data.labels[context.dataIndex];
      return winners.includes(label) ? '#28a745' : '#6c757d';
    }
  }]
};

new Chart(document.getElementById('chart'), {
  type:'bar',
  data: chartData,
  options: {
    responsive: true,
    plugins: {
      legend: {
        display: false
      },
      tooltip: {
        callbacks: {
          afterLabel: function(context) {
            const winners = {{winners|tojson}};
            const label = context.label;
            if (winners.includes(label)) {
              const rank = winners.indexOf(label) + 1;
              return `#${rank} - Selected for trip!`;
            }
            return 'Not selected';
          }
        }
      }
    },
    scales: {
      y: {
        beginAtZero: true,
        ticks: {
          stepSize: 1
        }
      }
    }
  }
});
</script>

<div class="mt-4">
  <a href="/" class="btn btn-primary">‚Üê Back to Voting</a>
  <a href="/manage" class="btn btn-outline-secondary ms-2">Manage Your Vote</a>
</div>
</div>
</body>
</html>
